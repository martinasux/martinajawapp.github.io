<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>Käkträning</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#14161d;
      --muted:#9aa3b2;
      --text:#eef2ff;
      --accent:#7c5cff;
      --accent2:#24d2ff;
      --danger:#ff5c7a;
      --radius:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 700px at 20% -10%, rgba(124,92,255,.35), transparent 60%),
                  radial-gradient(900px 600px at 90% 10%, rgba(36,210,255,.25), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom) 16px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .app{
      width:min(430px, 100%);
      max-height: 100vh;
    }
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 8px 14px 8px;
    }
    .brand{
      display:flex; gap:10px; align-items:center;
    }
    .dot{
      width:12px; height:12px; border-radius:50%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 18px rgba(124,92,255,.6);
    }
    h1{font-size:18px; margin:0; letter-spacing:.2px}
    .small{color:var(--muted); font-size:12px}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
    }
    .media{
      padding: 14px 14px 0 14px;
    }
    .imgwrap{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px;
      overflow:hidden;
      aspect-ratio: 1 / 1;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .imgwrap img{
      width:100%;
      height:100%;
      object-fit: contain;
      display:block;
      background:#fff;
    }
    .content{
      padding: 14px 16px 16px 16px;
    }
    .title{
      display:flex; align-items:baseline; justify-content:space-between; gap:10px;
    }
    .title h2{margin:0; font-size:18px}
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background: rgba(124,92,255,.18);
      border:1px solid rgba(124,92,255,.35);
      color: var(--text);
      white-space:nowrap;
    }
    .desc{
      margin:10px 0 0 0;
      color: var(--text);
      line-height:1.35;
      font-size:14px;
    }
    .desc ul{margin:10px 0 0 18px; padding:0; color: var(--text)}
    .desc li{margin:6px 0}
    .muted{color:var(--muted)}
    .progress{
      height:10px;
      background: rgba(255,255,255,.08);
      border-radius:999px;
      overflow:hidden;
      margin: 14px 0 10px 0;
      border: 1px solid rgba(255,255,255,.08);
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius:999px;
      transition: width .2s linear;
    }
    .controls{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin-top: 12px;
    }
    button{
      appearance:none;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 12px 12px;
      border-radius: 16px;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      transition: transform .05s ease, background .2s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button:active{transform: scale(.98)}
    .primary{
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(36,210,255,.85));
      border: none;
      color:#071018;
    }
    .row{
      display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
    }
    .toggle{
      display:flex; gap:10px; align-items:center;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.12);
      font-size:13px;
      color: var(--muted);
    }
    .switch{
      width:46px; height:26px; border-radius:999px;
      background: rgba(255,255,255,.14);
      position:relative;
      border:1px solid rgba(255,255,255,.14);
      flex: 0 0 auto;
    }
    .knob{
      width:22px; height:22px; border-radius:50%;
      background:#fff;
      position:absolute;
      top:1px; left:1px;
      transition: left .15s ease;
    }
    .switch.on{ background: rgba(124,92,255,.35); border-color: rgba(124,92,255,.45);}
    .switch.on .knob{ left: 22px; }
    .footerNote{
      padding: 12px 8px 0 8px;
      font-size:12px;
      color: rgba(238,242,255,.65);
      line-height:1.35;
    }
    a{color: rgba(36,210,255,.95); text-decoration:none}
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <h1>Käkträning</h1>
          <div class="small">mini-app • 3–4 min • guidning + timer</div>
        </div>
      </div>
      <div class="small" id="stepCounter">1/7</div>
    </div>

    <div class="card">
      <div class="media">
        <div class="imgwrap">
          <img id="img" src="assets/neutral.png" alt="övningsbild">
        </div>
      </div>

      <div class="content">
        <div class="title">
          <h2 id="title">Start</h2>
          <div class="pill" id="timerPill">⏱️ 10s</div>
        </div>

        <div class="desc" id="desc"></div>

        <div class="progress" aria-label="progress">
          <div class="bar" id="bar"></div>
        </div>

        <div class="controls">
          <button id="prevBtn">◀︎</button>
          <button class="primary" id="playBtn">Starta</button>
          <button id="nextBtn">▶︎</button>
        </div>

        <div class="row">
          <div class="toggle" id="voiceToggle" role="button" tabindex="0" aria-pressed="true" title="Slå på/av uppläsning">
            <span>Röst</span>
            <div class="switch on" id="voiceSwitch"><div class="knob"></div></div>
            <span class="muted" id="voiceState">på</span>
          </div>

          <div class="toggle" id="autoToggle" role="button" tabindex="0" aria-pressed="true" title="Auto-nästa efter timer">
            <span>Auto</span>
            <div class="switch on" id="autoSwitch"><div class="knob"></div></div>
            <span class="muted" id="autoState">på</span>
          </div>
        </div>
      </div>
    </div>

    <div class="footerNote">
      Tips: Lägg till på hemskärmen (iOS): dela → <b>Lägg till på hemskärmen</b>. <br/>
      Obs: gör bara rörelser som känns okej. Vid tydlig smärta, pausa och följ vårdens råd.
    </div>
  </div>

<script>
const steps = [
  {
    key:"start",
    title:"Start",
    seconds:10,
    img:"assets/neutral.png",
    speak:"Vi kör en kort käkträning. Gör allt mjukt och utan att bita ihop. Tryck start när du är redo.",
    html:`<p class="muted">Du får guidning + timer. Gör bara det som känns okej.</p>
          <ul>
            <li>Axlar ner, käke av</li>
            <li>Tänderna vilar isär</li>
            <li>Andas lugnt</li>
          </ul>`
  },
  {
    key:"posture",
    title:"Steg 1 – Hållning",
    seconds:10,
    img:"assets/neutral.png",
    speak:"Steg ett. Hållning. Sitt eller stå med rak rygg. Sänk axlarna. Låt käken vila.",
    html:`<ul>
            <li>Rak rygg</li>
            <li>Axlar ner</li>
            <li>Slappna av i ansiktet</li>
          </ul>`
  },
  {
    key:"breathing",
    title:"Steg 2 – Magandning",
    seconds:15,
    img:"assets/neutral.png",
    speak:"Steg två. Magandning. Hand på magen. Andas in långsamt. Pausa två sekunder. Andas ut helt.",
    html:`<ul>
            <li>In genom näsan (lugnt)</li>
            <li>Pausa 2 sek</li>
            <li>Ut långsamt</li>
          </ul>`
  },
  {
    key:"jogging",
    title:"Steg 3 – Käkjogging",
    seconds:30,
    img:"assets/open_wide.png",
    speak:"Steg tre. Käkjogging. Små mini-öppningar och stängningar. Tänderna ska inte nudda. Tio repetitioner.",
    html:`<ul>
            <li>Små rörelser upp/ner</li>
            <li>Tänderna nuddar inte</li>
            <li>10 reps</li>
          </ul><p class="muted">Knastrigt kan vara okej – men ingen skarp smärta.</p>`
  },
  {
    key:"openclose",
    title:"Steg 4 – Öppna och stäng",
    seconds:30,
    img:"assets/open_wide.png",
    speak:"Steg fyra. Öppna och stäng. Gapa så långt det känns mjukt. Pausa en sekund. Stäng långsamt. Tio repetitioner.",
    html:`<ul>
            <li>Öppna lugnt (bekvämt)</li>
            <li>Pausa 1 sek</li>
            <li>Stäng långsamt</li>
            <li>10 reps</li>
          </ul>`
  },
  {
    key:"sides",
    title:"Steg 5 – Sidoglidning",
    seconds:30,
    img:"assets/look_right.png",
    speak:"Steg fem. Sidoglidning. För underkäken mjukt åt ena sidan och tillbaka. Byt sida. Tio per sida.",
    html:`<ul>
            <li>Skjut underkäken mjukt åt sidan</li>
            <li>Tillbaka till mitten</li>
            <li>10 per sida</li>
          </ul><p class="muted">Tryck inte – det ska kännas kontrollerat.</p>`
  },
  {
    key:"resistance",
    title:"Steg 6 – Motstånd",
    seconds:30,
    img:"assets/hand_resist.png",
    speak:"Steg sex. Motstånd. Lägg handen mot hakan och håll emot lite medan du försöker öppna eller glida. Håll sex sekunder. Släpp. Upprepa fem gånger.",
    html:`<ul>
            <li>Handen ger lätt motstånd</li>
            <li>Håll ~6 sek</li>
            <li>Släpp</li>
            <li>5–6 gånger</li>
          </ul>`
  },
  {
    key:"finish",
    title:"Klart ✨",
    seconds:15,
    img:"assets/neutral.png",
    speak:"Bra jobbat. Låt käken vila. Tänderna isär, läpparna mjukt ihop. Andas lugnt i femton sekunder.",
    html:`<p>Nice. Du är klar.</p>
          <ul>
            <li>Tänderna vilar isär</li>
            <li>Andas lugnt</li>
            <li>Släpp spänningen i käken</li>
          </ul>`
  }
];

let idx = 0;
let running = false;
let remaining = steps[0].seconds;
let interval = null;

let voiceOn = true;
let autoOn = true;

const elImg = document.getElementById('img');
const elTitle = document.getElementById('title');
const elDesc = document.getElementById('desc');
const elPill = document.getElementById('timerPill');
const elBar = document.getElementById('bar');
const elPlay = document.getElementById('playBtn');
const elPrev = document.getElementById('prevBtn');
const elNext = document.getElementById('nextBtn');
const elStepCounter = document.getElementById('stepCounter');

const voiceToggle = document.getElementById('voiceToggle');
const voiceSwitch = document.getElementById('voiceSwitch');
const voiceState = document.getElementById('voiceState');

const autoToggle = document.getElementById('autoToggle');
const autoSwitch = document.getElementById('autoSwitch');
const autoState = document.getElementById('autoState');

function speak(text){
  if(!voiceOn) return;
  if(!('speechSynthesis' in window)) return;
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'sv-SE';
  u.rate = 1.0;
  u.pitch = 1.0;
  window.speechSynthesis.speak(u);
}

function render(){
  const s = steps[idx];
  elImg.src = s.img;
  elTitle.textContent = s.title;
  elDesc.innerHTML = s.html;
  elPill.textContent = `⏱️ ${remaining}s`;
  elStepCounter.textContent = `${idx+1}/${steps.length}`;
  updateProgress();
}

function updateProgress(){
  const s = steps[idx];
  const pct = Math.max(0, Math.min(1, (s.seconds - remaining) / s.seconds));
  elBar.style.width = (pct*100).toFixed(0) + "%";
}

function stopTimer(){
  running = false;
  clearInterval(interval);
  interval = null;
  elPlay.textContent = "Starta";
}

function startTimer(){
  if(running) return;
  running = true;
  elPlay.textContent = "Paus";
  interval = setInterval(() => {
    remaining -= 1;
    if(remaining < 0) remaining = 0;
    elPill.textContent = `⏱️ ${remaining}s`;
    updateProgress();
    if(remaining === 0){
      clearInterval(interval);
      interval = null;
      running = false;
      elPlay.textContent = "Starta";
      if(autoOn){
        next();
      }
    }
  }, 1000);
}

function togglePlay(){
  if(running){ stopTimer(); }
  else{
    if(remaining === 0){ remaining = steps[idx].seconds; }
    startTimer();
    speak(steps[idx].speak);
  }
}

function setStep(newIdx){
  stopTimer();
  idx = Math.max(0, Math.min(steps.length-1, newIdx));
  remaining = steps[idx].seconds;
  render();
  speak(steps[idx].speak);
}

function next(){
  if(idx === 5){ // special: sidoglidning -> show left image halfway through if auto
    // nothing
  }
  if(idx < steps.length-1){
    setStep(idx+1);
  } else {
    setStep(0);
  }
}

function prev(){
  if(idx > 0) setStep(idx-1);
}

elPlay.addEventListener('click', togglePlay);
elNext.addEventListener('click', next);
elPrev.addEventListener('click', prev);

// Tap image to toggle play (nice mobile UX)
document.querySelector('.imgwrap').addEventListener('click', togglePlay);

// Toggles
function setVoice(on){
  voiceOn = on;
  voiceSwitch.classList.toggle('on', on);
  voiceState.textContent = on ? "på" : "av";
  voiceToggle.setAttribute('aria-pressed', String(on));
  if(!on && 'speechSynthesis' in window) window.speechSynthesis.cancel();
}
function setAuto(on){
  autoOn = on;
  autoSwitch.classList.toggle('on', on);
  autoState.textContent = on ? "på" : "av";
  autoToggle.setAttribute('aria-pressed', String(on));
}

voiceToggle.addEventListener('click', () => setVoice(!voiceOn));
autoToggle.addEventListener('click', () => setAuto(!autoOn));

// Keyboard support
voiceToggle.addEventListener('keydown', (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); setVoice(!voiceOn);} });
autoToggle.addEventListener('keydown', (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); setAuto(!autoOn);} });

// On sidoglidning: swap image left/right every 5s while running
setInterval(()=>{
  const s = steps[idx];
  if(s.key !== "sides") return;
  if(!running) return;
  const elapsed = s.seconds - remaining;
  const showLeft = Math.floor(elapsed / 5) % 2 === 1;
  elImg.src = showLeft ? "assets/look_left.png" : "assets/look_right.png";
}, 400);

render();
speak(steps[0].speak);
</script>
</body>
</html>
